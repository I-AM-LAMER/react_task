{"version":3,"file":"TableTextFilter.js","names":["IconSearchStroked","React","useMemo","useState","cnMixScrollBar","cn","Button","CheckboxGroup","Text","TextField","TableFilterContainer","cnTextFilter","sanitizeRegex","futureRegex","replaceAll","intersectArrays","one","other","filter","oneValue","value","some","otherValue","TableTextFilter","items","withSearch","onConfirm","onCancel","filterValue","title","emptySearchText","searchValue","setSearchValue","checkboxGroupValue","setCheckboxGroupValue","filteredItems","regex","RegExp","name","match","filteredAndChecked","isAllSelected","length","isSelected","confirmHandler","setAll","resetHandler","item"],"sources":["../../../../../../src/components/Table/TextFilter/TableTextFilter.tsx"],"sourcesContent":["import './TableTextFilter.css';\n\nimport { IconSearchStroked } from '@consta/icons/IconSearchStroked';\nimport React, { useMemo, useState } from 'react';\n\nimport { cnMixScrollBar } from '##/mixs/MixScrollBar';\n\nimport { cn } from '../../../utils/bem';\nimport { Button } from '../../Button/Button';\nimport { CheckboxGroup } from '../../CheckboxGroup';\nimport { Text } from '../../Text/Text';\nimport { TextField } from '../../TextField/TextField';\nimport { TableFilterContainer } from '../FilterContainer/TableFilterContainer';\nimport { FilterComponentProps } from '../filtering';\n\nconst cnTextFilter = cn('TableTextFilter');\n\ntype Item = {\n  name: string;\n  value: string;\n};\n\ntype TableTextFilterProps = FilterComponentProps & {\n  items?: Item[];\n  withSearch?: boolean;\n  title?: string;\n  emptySearchText?: string;\n};\n\nconst sanitizeRegex = (futureRegex: string): string =>\n  futureRegex\n    .replaceAll(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n    .replaceAll(/\\$/g, '$$$$');\n\nconst intersectArrays = (one: Item[], other: Item[]) =>\n  one.filter(({ value: oneValue }) =>\n    other.some(({ value: otherValue }) => oneValue === otherValue),\n  );\n\nexport const TableTextFilter: React.FC<TableTextFilterProps> = ({\n  items = [],\n  withSearch = false,\n  onConfirm,\n  onCancel,\n  filterValue,\n  title,\n  emptySearchText = 'Ничего не найдено :(',\n}) => {\n  const [searchValue, setSearchValue] = useState<string | null>(null);\n  const [checkboxGroupValue, setCheckboxGroupValue] = useState<Item[] | null>(\n    (filterValue as Item[]) || items,\n  );\n\n  const filteredItems = useMemo(() => {\n    if (!searchValue) {\n      return items;\n    }\n\n    const regex = new RegExp(sanitizeRegex(searchValue), 'i');\n\n    return items.filter(({ name }) => name.match(regex));\n  }, [searchValue, items]);\n\n  const setAll = () => {\n    setCheckboxGroupValue(filteredItems);\n  };\n\n  const filteredAndChecked = useMemo(\n    () => intersectArrays(filteredItems, checkboxGroupValue ?? []),\n    [filteredItems, checkboxGroupValue],\n  );\n\n  const isAllSelected = useMemo(\n    () => filteredItems.length === filteredAndChecked.length,\n    [filteredItems, filteredAndChecked],\n  );\n\n  const isSelected = useMemo(\n    () => filteredAndChecked.length,\n    [filteredAndChecked],\n  );\n\n  const confirmHandler = () => {\n    setSearchValue(null);\n    onConfirm(filteredAndChecked);\n  };\n\n  const resetHandler = () => {\n    setCheckboxGroupValue(null);\n  };\n\n  return (\n    <TableFilterContainer\n      title={title}\n      onCancel={onCancel}\n      onConfirm={confirmHandler}\n    >\n      {withSearch && (\n        <TextField\n          value={searchValue}\n          onChange={setSearchValue}\n          leftSide={IconSearchStroked}\n          size=\"s\"\n          placeholder=\"Найти в списке\"\n          className={cnTextFilter('Searchbar')}\n        />\n      )}\n      <div className={cnTextFilter('Controls')}>\n        <Button\n          size=\"m\"\n          type=\"button\"\n          form=\"brick\"\n          label=\"Выбрать все\"\n          view=\"clear\"\n          onClick={setAll}\n          disabled={!filteredItems.length || isAllSelected}\n        />\n        <Button\n          size=\"m\"\n          form=\"brick\"\n          type=\"button\"\n          label=\"Сбросить\"\n          view=\"clear\"\n          onClick={resetHandler}\n          disabled={!filteredItems.length || !isSelected}\n        />\n      </div>\n      <div className={cnTextFilter('Checkboxes', [cnMixScrollBar()])}>\n        {filteredItems.length ? (\n          <CheckboxGroup\n            items={filteredItems}\n            value={checkboxGroupValue}\n            getItemLabel={(item) => item.name}\n            onChange={setCheckboxGroupValue}\n            name=\"checkboxGroup\"\n          />\n        ) : (\n          <Text lineHeight=\"2xs\" view=\"primary\" size=\"m\">\n            {emptySearchText}\n          </Text>\n        )}\n      </div>\n    </TableFilterContainer>\n  );\n};\n"],"mappings":"iEAAA,8BAEA,OAASA,iBAAT,KAAkC,iCAAlC,CACA,MAAOC,MAAP,EAAgBC,OAAhB,CAAyBC,QAAzB,KAAyC,OAAzC,CAEA,OAASC,cAAT,kCAEA,OAASC,EAAT,0BACA,OAASC,MAAT,2BACA,OAASC,aAAT,2BACA,OAASC,IAAT,uBACA,OAASC,SAAT,iCACA,OAASC,oBAAT,+C,GAGMC,aAAY,CAAGN,EAAE,CAAC,iBAAD,C,CAcjBO,aAAa,CAAG,SAACC,CAAD,QACpBA,EAAW,CACRC,UADH,CACc,qBADd,CACqC,MADrC,EAEGA,UAFH,CAEc,KAFd,CAEqB,MAFrB,CADoB,C,CAKhBC,eAAe,CAAG,SAACC,CAAD,CAAcC,CAAd,QACtBD,EAAG,CAACE,MAAJ,CAAW,eAAUC,EAAV,GAAGC,KAAH,OACTH,EAAK,CAACI,IAAN,CAAW,eAAUC,EAAV,GAAGF,KAAH,OAA2BD,EAAQ,GAAKG,CAAxC,CAAX,CADS,CAAX,CADsB,C,CAKxB,MAAO,IAAMC,gBAA+C,CAAG,WAQzD,SAPJC,KAOI,CAPJA,CAOI,YAPI,EAOJ,OANJC,UAMI,CALJC,CAKI,GALJA,SAKI,CAJJC,CAII,GAJJA,QAII,CAHJC,CAGI,GAHJA,WAGI,CAFJC,CAEI,GAFJA,KAEI,KADJC,eACI,CADJA,CACI,YADc,iGACd,KACkC3B,QAAQ,CAAgB,IAAhB,CAD1C,uBACG4B,CADH,MACgBC,CADhB,QAEgD7B,QAAQ,CACzDyB,CAAD,EAA2BJ,CAD+B,CAFxD,uBAEGS,CAFH,MAEuBC,CAFvB,MAMEC,CAAa,CAAGjC,OAAO,CAAC,UAAM,CAClC,GAAI,CAAC6B,CAAL,CACE,MAAOP,EAAP,CAGF,GAAMY,EAAK,CAAG,GAAIC,OAAJ,CAAWzB,aAAa,CAACmB,CAAD,CAAxB,CAAuC,GAAvC,CAAd,CAEA,MAAOP,EAAK,CAACN,MAAN,CAAa,eAAGoB,EAAH,GAAGA,IAAH,OAAcA,EAAI,CAACC,KAAL,CAAWH,CAAX,CAAd,CAAb,CACR,CAR4B,CAQ1B,CAACL,CAAD,CAAcP,CAAd,CAR0B,CANzB,CAoBEgB,CAAkB,CAAGtC,OAAO,CAChC,iBAAMa,gBAAe,CAACoB,CAAD,QAAgBF,CAAhB,WAAgBA,CAAhB,CAAgBA,CAAhB,CAAsC,EAAtC,CAArB,CADgC,CAEhC,CAACE,CAAD,CAAgBF,CAAhB,CAFgC,CApB9B,CAyBEQ,CAAa,CAAGvC,OAAO,CAC3B,iBAAMiC,EAAa,CAACO,MAAd,GAAyBF,CAAkB,CAACE,MAAlD,CAD2B,CAE3B,CAACP,CAAD,CAAgBK,CAAhB,CAF2B,CAzBzB,CA8BEG,CAAU,CAAGzC,OAAO,CACxB,iBAAMsC,EAAkB,CAACE,MAAzB,CADwB,CAExB,CAACF,CAAD,CAFwB,CA9BtB,CA4CJ,MACE,qBAAC,oBAAD,EACE,KAAK,CAAEX,CADT,CAEE,QAAQ,CAAEF,CAFZ,CAGE,SAAS,CAbU,QAAjBiB,eAAiB,EAAM,CAC3BZ,CAAc,CAAC,IAAD,CADa,CAE3BN,CAAS,CAACc,CAAD,CACV,CAOC,EAKG,eACC,oBAAC,SAAD,EACE,KAAK,CAAET,CADT,CAEE,QAAQ,CAAEC,CAFZ,CAGE,QAAQ,CAAEhC,iBAHZ,CAIE,IAAI,CAAC,GAJP,CAKE,WAAW,CAAC,4EALd,CAME,SAAS,CAAEW,YAAY,CAAC,WAAD,CANzB,EANJ,CAeE,2BAAK,SAAS,CAAEA,YAAY,CAAC,UAAD,CAA5B,EACE,oBAAC,MAAD,EACE,IAAI,CAAC,GADP,CAEE,IAAI,CAAC,QAFP,CAGE,IAAI,CAAC,OAHP,CAIE,KAAK,CAAC,+DAJR,CAKE,IAAI,CAAC,OALP,CAME,OAAO,CAnDA,QAATkC,OAAS,EAAM,CACnBX,CAAqB,CAACC,CAAD,CACtB,CA2CK,CAOE,QAAQ,CAAE,CAACA,CAAa,CAACO,MAAf,EAAyBD,CAPrC,EADF,CAUE,oBAAC,MAAD,EACE,IAAI,CAAC,GADP,CAEE,IAAI,CAAC,OAFP,CAGE,IAAI,CAAC,QAHP,CAIE,KAAK,CAAC,kDAJR,CAKE,IAAI,CAAC,OALP,CAME,OAAO,CApCM,QAAfK,aAAe,EAAM,CACzBZ,CAAqB,CAAC,IAAD,CACtB,CA4BK,CAOE,QAAQ,CAAE,CAACC,CAAa,CAACO,MAAf,EAAyB,CAACC,CAPtC,EAVF,CAfF,CAmCE,2BAAK,SAAS,CAAEhC,YAAY,CAAC,YAAD,CAAe,CAACP,cAAc,EAAf,CAAf,CAA5B,EACG+B,CAAa,CAACO,MAAd,CACC,oBAAC,aAAD,EACE,KAAK,CAAEP,CADT,CAEE,KAAK,CAAEF,CAFT,CAGE,YAAY,CAAE,sBAACc,CAAD,QAAUA,EAAI,CAACT,IAAf,CAHhB,CAIE,QAAQ,CAAEJ,CAJZ,CAKE,IAAI,CAAC,eALP,EADD,CASC,oBAAC,IAAD,EAAM,UAAU,CAAC,KAAjB,CAAuB,IAAI,CAAC,SAA5B,CAAsC,IAAI,CAAC,GAA3C,EACGJ,CADH,CAVJ,CAnCF,CAoDH,CAzGM"}