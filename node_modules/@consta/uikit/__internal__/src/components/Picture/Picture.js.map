{"version":3,"file":"Picture.js","names":["React","forwardRef","useMemo","getLastPoint","useBreakpoints","useTheme","defaultGetImageSettings","getConvertedImages","getSrcHash","Picture","props","ref","alt","srcProp","src","getImageSettings","subscribeToRef","otherProps","theme","images","reduce","a","size","convertedImages","sizes","activeImageSize","map","isActive","suitableImages","filter","targetTheme","color","primary","sort","b","descriptor","replace","length","encodeURI","join","srcSet"],"sources":["../../../../../src/components/Picture/Picture.tsx"],"sourcesContent":["import React, { forwardRef, useMemo } from 'react';\n\nimport { getLastPoint, useBreakpoints } from '##/hooks/useBreakpoints';\n\nimport { useTheme } from '../Theme';\nimport {\n  defaultGetImageSettings,\n  getConvertedImages,\n  getSrcHash,\n} from './helper';\nimport { PictureProps } from './types';\n\nexport const Picture = forwardRef<HTMLImageElement, PictureProps>(\n  (props, ref) => {\n    const {\n      alt = '',\n      src: srcProp,\n      getImageSettings = defaultGetImageSettings,\n      subscribeToRef,\n      ...otherProps\n    } = props;\n\n    const { theme } = useTheme();\n\n    const [convertedImages, sizes]: [\n      Array<{\n        theme?: string;\n        descriptor?: string;\n        src: string;\n        key: string;\n        size?: number;\n      }>,\n      Record<string, number>,\n    ] = useMemo(() => {\n      const images = getConvertedImages(srcProp, getImageSettings);\n      return [\n        images,\n        images.reduce((a, { size = 0 }) => ({ ...a, [size]: size }), {}),\n      ];\n    }, [getSrcHash(srcProp)]);\n\n    const activeImageSize = Number(\n      getLastPoint(\n        useBreakpoints({\n          map: sizes,\n          isActive: true,\n          ref: subscribeToRef,\n        }),\n      ) ?? -1,\n    );\n\n    const suitableImages = useMemo(() => {\n      return convertedImages\n        .filter(\n          ({ size, theme: targetTheme }) =>\n            (!targetTheme || theme.color.primary === targetTheme) &&\n            (typeof size !== 'number' || activeImageSize === size),\n        )\n        .sort((a, b) => {\n          if (a.descriptor && b.descriptor) {\n            return Number(a.descriptor.replace(/[^0-9.]+/g, '')) <\n              Number(b.descriptor.replace(/[^0-9.]+/g, ''))\n              ? -1\n              : 1;\n          }\n          return 0;\n        });\n    }, [activeImageSize, theme, convertedImages]);\n\n    const [src, srcSet] = useMemo(() => {\n      if (suitableImages.length === 0) {\n        return [];\n      }\n      if (suitableImages.length > 1) {\n        return [\n          encodeURI(suitableImages[0]?.src),\n          suitableImages\n            .map(({ src, descriptor }) => `${encodeURI(src)} ${descriptor}`)\n            .join(','),\n        ];\n      }\n      return [suitableImages[0]?.src];\n    }, [suitableImages]);\n\n    return src ? (\n      <img {...otherProps} ref={ref} alt={alt} src={src} srcSet={srcSet} />\n    ) : null;\n  },\n);\n"],"mappings":"23BAAA,MAAOA,MAAP,EAAgBC,UAAhB,CAA4BC,OAA5B,KAA2C,OAA3C,CAEA,OAASC,YAAT,CAAuBC,cAAvB,kCAEA,OAASC,QAAT,gBACA,OACEC,uBADF,CAEEC,kBAFF,CAGEC,UAHF,gBAOA,MAAO,IAAMC,QAAO,CAAGR,UAAU,CAC/B,SAACS,CAAD,CAAQC,CAAR,CAAgB,SAOVD,CAPU,CAEZE,GAFY,CAEZA,CAFY,YAEN,EAFM,GAGPC,CAHO,CAOVH,CAPU,CAGZI,GAHY,GAOVJ,CAPU,CAIZK,gBAJY,CAIZA,CAJY,YAIOT,uBAJP,GAKZU,CALY,CAOVN,CAPU,CAKZM,cALY,CAMTC,CANS,0BAOVP,CAPU,cASIL,QAAQ,EATZ,CASNa,CATM,GASNA,KATM,GAoBVhB,OAAO,CAAC,UAAM,CAChB,GAAMiB,EAAM,CAAGZ,kBAAkB,CAACM,CAAD,CAAUE,CAAV,CAAjC,CACA,MAAO,CACLI,CADK,CAELA,CAAM,CAACC,MAAP,CAAc,SAACC,CAAD,YAAMC,IAAN,CAAMA,CAAN,YAAa,CAAb,yCAA2BD,CAA3B,wBAA+BC,CAA/B,CAAsCA,CAAtC,GAAd,CAA6D,EAA7D,CAFK,CAIR,CANU,CAMR,CAACd,UAAU,CAACK,CAAD,CAAX,CANQ,CApBG,uBAWPU,CAXO,MAWUC,CAXV,MA4BRC,CAAe,aACnBtB,YAAY,CACVC,cAAc,CAAC,CACbsB,GAAG,CAAEF,CADQ,CAEbG,QAAQ,GAFK,CAGbhB,GAAG,CAAEK,CAHQ,CAAD,CADJ,CADO,gBAOd,CAAC,CAPa,CA5BP,CAsCRY,CAAc,CAAG1B,OAAO,CAAC,UAAM,CACnC,MAAOqB,EAAe,CACnBM,MADI,CAEH,eAAGP,EAAH,GAAGA,IAAH,CAAgBQ,CAAhB,GAASZ,KAAT,OACE,CAAC,CAACY,CAAD,EAAgBZ,CAAK,CAACa,KAAN,CAAYC,OAAZ,GAAwBF,CAAzC,IACiB,QAAhB,QAAOR,EAAP,EAA4BG,CAAe,GAAKH,CADjD,CADF,CAFG,EAMJW,IANI,CAMC,SAACZ,CAAD,CAAIa,CAAJ,CAAU,OACVb,EAAC,CAACc,UAAF,EAAgBD,CAAC,CAACC,UADR,CAEL,CAAOd,CAAC,CAACc,UAAF,CAAaC,OAAb,CAAqB,WAArB,CAAkC,EAAlC,CAAP,EACEF,CAAC,CAACC,UAAF,CAAaC,OAAb,CAAqB,WAArB,CAAkC,EAAlC,CADF,CAEH,CAAC,CAFE,CAGH,CALQ,CAOP,CACR,CAdI,CAeR,CAhB6B,CAgB3B,CAACX,CAAD,CAAkBP,CAAlB,CAAyBK,CAAzB,CAhB2B,CAtChB,GAwDQrB,OAAO,CAAC,UAAM,OAClC,GAA8B,CAA1B,GAAA0B,CAAc,CAACS,MAAnB,CACE,MAAO,EAAP,CAEF,GAA4B,CAAxB,CAAAT,CAAc,CAACS,MAAnB,CAA+B,OAC7B,MAAO,CACLC,SAAS,WAACV,CAAc,CAAC,CAAD,CAAf,qBAAC,EAAmBd,GAApB,CADJ,CAELc,CAAc,CACXF,GADH,CACO,eAAGZ,EAAH,GAAGA,GAAH,CAAQqB,CAAR,GAAQA,UAAR,iBAA4BG,SAAS,CAACxB,CAAD,CAArC,aAA8CqB,CAA9C,EADP,EAEGI,IAFH,CAEQ,GAFR,CAFK,CAMR,CACD,MAAO,WAACX,CAAc,CAAC,CAAD,CAAf,qBAAC,EAAmBd,GAApB,CACR,CAb4B,CAa1B,CAACc,CAAD,CAb0B,CAxDf,uBAwDPd,CAxDO,MAwDF0B,CAxDE,MAuEd,MAAO1B,EAAG,CACR,2CAASG,CAAT,EAAqB,GAAG,CAAEN,CAA1B,CAA+B,GAAG,CAAEC,CAApC,CAAyC,GAAG,CAAEE,CAA9C,CAAmD,MAAM,CAAE0B,CAA3D,GADQ,CAEN,IACL,CA3E8B,CAA1B"}