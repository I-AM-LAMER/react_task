import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";var _excluded=["className","type","value","defaultValue","onChange","id","name","rows","cols","minRows","maxRows","inputRef","maxLength","disabled","size","view","form","state","status","onBlur","onFocus","autoFocus","placeholder","leftSide","rightSide","autoComplete","withClearButton","incrementButtons","max","min","readOnly","required","step","tabIndex","ariaLabel","label","labelIcon","inputContainerRef","labelPosition","caption","iconSize","focused","onClick","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onClear","onWheel"];import"./TextField.css";import{IconClear}from"@consta/icons/IconClear";import{IconEye}from"@consta/icons/IconEye";import{IconEyeClose}from"@consta/icons/IconEyeClose";import{IconSelect}from"@consta/icons/IconSelect";import React,{forwardRef,useCallback,useEffect}from"react";import TextAreaAutoSize from"react-textarea-autosize";import{usePropsHandler}from"../EventInterceptor/usePropsHandler";import{FieldCaption}from"../FieldCaption/FieldCaption";import{FieldLabel}from"../FieldLabel/FieldLabel";import{useFlag}from"../../hooks/useFlag/useFlag";import{useForkRef}from"../../hooks/useForkRef/useForkRef";import{useKeys}from"../../hooks/useKeys";import{useMutableRef}from"../../hooks/useMutableRef/useMutableRef";import{useSortSteps}from"../../hooks/useSortSteps/useSortSteps";import{cn}from"../../utils/bem";import{getByMap}from"../../utils/getByMap";import{isString}from"../../utils/type-guards";import{getTypeForRender,getValueByStep,inputValue,sizeMap,stepIsActive}from"./helpers";import{textFieldPropFormDefault,textFieldPropSizeDefault,textFieldPropViewDefault}from"./types";export var COMPONENT_NAME="TextField";export var cnTextField=cn("TextField");export var TextFieldRender=function(a,b){var c,d,e=React.useRef(null),f=React.useRef(null),g=usePropsHandler(COMPONENT_NAME,a,e),h=g.className,i=g.type,j=void 0===i?"text":i,k=g.value,l=g.defaultValue,m=g.onChange,n=g.id,o=g.name,p=g.rows,q=g.cols,r=g.minRows,s=g.maxRows,t=g.inputRef,u=g.maxLength,v=g.disabled,w=g.size,x=void 0===w?textFieldPropSizeDefault:w,y=g.view,z=void 0===y?textFieldPropViewDefault:y,A=g.form,B=void 0===A?textFieldPropFormDefault:A,C=g.state,D=g.status,E=g.onBlur,F=g.onFocus,G=g.autoFocus,H=void 0!==G&&G,I=g.placeholder,J=g.leftSide,K=g.rightSide,L=g.autoComplete,M=g.withClearButton,N=g.incrementButtons,O=g.max,P=g.min,Q=g.readOnly,R=g.required,S=g.step,T=void 0===S?1:S,U=g.tabIndex,V=g.ariaLabel,W=g.label,X=g.labelIcon,Y=g.inputContainerRef,Z=g.labelPosition,$=void 0===Z?"top":Z,_=g.caption,aa=g.iconSize,ba=g.focused,ca=g.onClick,da=g.onKeyDown,ea=g.onKeyDownCapture,fa=g.onKeyPress,ga=g.onKeyPressCapture,ha=g.onKeyUp,ia=g.onKeyUpCapture,ja=g.onClear,ka=g.onWheel,la=_objectWithoutProperties(g,_excluded),ma="number"===j&&(void 0===N||N),na=useFlag(H),oa=_slicedToArray(na,2),pa=oa[0],qa=oa[1],ra=useFlag(),sa=_slicedToArray(ra,2),ta=sa[0],ua=sa[1],va=useFlag(),wa=_slicedToArray(va,2),xa=wa[0],ya=wa[1],za=useMutableRef(ca),Aa=useMutableRef(m),Ba=useCallback(function(a){var b;a.stopPropagation(),ua.toggle(),null===(b=f.current)||void 0===b?void 0:b.focus()},[]),Ca=J,Da=K,Ea=isString(J),Fa=isString(K),Ga=getByMap(sizeMap,x,aa),Ha=useSortSteps({step:T,min:+P,max:+O}),Ia=useCallback(function(a){var b;v||(null===(b=Aa.current)||void 0===b?void 0:b.call(Aa,a.target.value||null,{e:a,id:n,name:o})),a.target.value?ya.on():ya.off()},[n,o,v]),Ja=function(a){qa.on(),null===F||void 0===F?void 0:F(a)},Ka={className:cnTextField("Input"),value:inputValue(k),defaultValue:inputValue(l),onChange:Ia,maxLength:u,disabled:v,onBlur:function handleBlur(a){qa.off(),null===E||void 0===E?void 0:E(a)},onFocus:Ja,autoFocus:H,placeholder:I,autoComplete:L,readOnly:Q,tabIndex:U,name:o,onKeyDownCapture:ea,onKeyPress:fa,onKeyPressCapture:ga,onKeyUp:ha,onKeyUpCapture:ia,id:n?n.toString():void 0,"aria-label":V},La=ta?IconEyeClose:IconEye,Ma=useKeys({isActive:!0,keys:{ArrowUp:function ArrowUp(a){if(a.preventDefault(),stepIsActive(T,j,v)){var b,c,d=getValueByStep(Ha,null===(b=f.current)||void 0===b?void 0:b.value,!0,P,O);null===(c=Aa.current)||void 0===c?void 0:c.call(Aa,d,{e:a,id:n,name:o}),f.current&&(f.current.value=d,ya.on())}},ArrowDown:function ArrowDown(a){if(a.preventDefault(),stepIsActive(T,j,v)){var b,c,d=getValueByStep(Ha,null===(b=f.current)||void 0===b?void 0:b.value,!1,P,O);null===(c=Aa.current)||void 0===c?void 0:c.call(Aa,d,{e:a,id:n,name:o}),f.current&&(f.current.value=d,ya.on())}}},onEvent:da}),Na={rows:p,cols:q,minRows:r||p,maxRows:s||p,ref:useForkRef([f,t])},Oa={type:getTypeForRender(j,ta),max:O,min:P,step:Array.isArray(Ha)?0:Ha,onKeyDown:Ma,onWheel:function onWheel(a){if(ka)ka(a);else if("number"===j){var b;null===(b=f.current)||void 0===b?void 0:b.blur()}},ref:useForkRef([f,t])},Pa=useCallback(function(a){var b;null===(b=Aa.current)||void 0===b?void 0:b.call(Aa,null,{e:a,id:n,name:o}),f.current&&(f.current.value="",ya.off())},[]),Qa=function(a){var b,c,d=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=getValueByStep(Ha,null===(b=f.current)||void 0===b?void 0:b.value,d,P,O);null===(c=Aa.current)||void 0===c?void 0:c.call(Aa,e,{e:a,id:n,name:o}),f.current&&(f.current.value=e,ya.on())},Ra={onClick:useCallback(function(a){var b,c;null===(b=f.current)||void 0===b?void 0:b.focus(),null===(c=za.current)||void 0===c?void 0:c.call(za,a)},[])};return useEffect(function(){var a;ya[null!==(a=f.current)&&void 0!==a&&a.value?"on":"off"]()},[null===(c=f.current)||void 0===c?void 0:c.value]),React.createElement("div",Object.assign({className:cnTextField({labelPosition:$,size:x,view:z},[h]),ref:useForkRef([b,e])},Ra,la),W&&React.createElement(FieldLabel,{as:"label",htmlFor:null===n||void 0===n?void 0:n.toString(),icon:X,required:R,className:cnTextField("Label",{labelPosition:$}),size:x},W),React.createElement("div",{className:cnTextField("Body")},React.createElement("div",{ref:Y,className:cnTextField("InputContainer",{view:z,form:B,status:D||C,disabled:v,type:j,focus:pa||ba,withValue:xa,incrementButtons:"number"===j&&ma})},Ca&&React.createElement("div",{className:cnTextField("Side",{position:"left",type:Ea?"string":"icon"}),title:"string"==typeof J?J:void 0},Ea?J:React.createElement(Ca,{className:cnTextField("Icon"),size:Ga})),"textarea"===j?React.createElement(TextAreaAutoSize,Object.assign({},Ka,Na)):React.createElement("input",Object.assign({},Ka,Oa)),ma&&stepIsActive(T,j,v)&&React.createElement("div",{className:cnTextField("Counter")},React.createElement("button",{className:cnTextField("CounterButton",{fn:"increment"}),onFocus:Ja,onClick:function(a){return Qa(a,!0)},type:"button"},React.createElement(IconSelect,{size:"xs"})),React.createElement("button",{className:cnTextField("CounterButton"),onFocus:Ja,onClick:function(a){return Qa(a,!1)},type:"button"},React.createElement(IconSelect,{size:"xs"}))),!ma&&xa&&M&&!v&&React.createElement("button",{type:"button",disabled:v,tabIndex:-1,onClick:ja||Pa,className:cnTextField("ClearButton")},React.createElement(IconClear,{size:sizeMap[x],className:cnTextField("ClearButtonIcon")})),"password"===j&&(null===(d=f.current)||void 0===d?void 0:d.value)&&React.createElement("button",{className:cnTextField("ClearButton"),type:"button",onClick:Ba},React.createElement(La,{className:cnTextField("Icon"),size:Ga})),Da&&!ma&&"password"!==j&&React.createElement("div",{className:cnTextField("Side",{position:"right",type:Fa?"string":"icon"}),title:"string"==typeof K?K:void 0},Fa?K:React.createElement(Da,{className:cnTextField("Icon"),size:Ga}))),_&&React.createElement(FieldCaption,{className:cnTextField("Caption"),status:D||C},_)))};export var TextField=forwardRef(TextFieldRender);export*from"./types";
//# sourceMappingURL=TextField.js.map