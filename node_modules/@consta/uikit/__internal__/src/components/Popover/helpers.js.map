{"version":3,"file":"helpers.js","names":["getPosition","x","y","Math","round","getPointPosition","viewportElement","positionInDocument","withCustomViewPort","viewportRect","getBoundingClientRect","position","left","top","getRenderPosition","width","height","window","scrollX","scrollY","clientWidth","clientHeight","getPositionsByDirection","contentSize","anchorSize","arrowOffset","offset","contentWidth","contentHeight","anchorWidth","anchorHeight","anchorCenter","xForRightDirections","xForLeftDirections","xForVerticalDirections","right","center","yForDownDirections","yForUpDirections","yForHorizontalDirections","up","down","xForStartLeftDirections","xForStartRightDirections","yForStartUpDirections","yForStartDownDirections","upLeft","upCenter","upRight","downLeft","downCenter","downRight","rightUp","rightCenter","rightDown","leftUp","leftCenter","leftDown","downStartLeft","downStartRight","upStartLeft","upStartRight","leftStartUp","leftStartDown","rightStartUp","rightStartDown","getComputedPositionAndDirection","initialPosition","viewportSize","initialDirection","direction","possibleDirections","bannedDirections","spareDirection","positionsByDirection","filter","dir","includes","find","pos","isFittingDown","isFittingUp","isFittingLeft","isFittingRight"],"sources":["../../../../../src/components/Popover/helpers.ts"],"sourcesContent":["import { Direction, Position } from './Popover';\n\ntype Size = Pick<DOMRect, 'width' | 'height'>;\n\ntype PositionsByDirection = Record<Direction, NonNullable<Position>>;\n\nconst getPosition = (x: number, y: number): NonNullable<Position> => ({\n  x: Math.round(x),\n  y: Math.round(y),\n});\n\nexport const getPointPosition = (\n  viewportElement: HTMLElement,\n  positionInDocument: Position,\n  withCustomViewPort: boolean,\n): Position => {\n  if (!positionInDocument) {\n    return undefined;\n  }\n\n  if (!withCustomViewPort) {\n    return positionInDocument;\n  }\n\n  const viewportRect = viewportElement.getBoundingClientRect();\n\n  const position: Position = getPosition(\n    positionInDocument.x - viewportRect.left,\n    positionInDocument.y - viewportRect.top,\n  );\n\n  return position;\n};\n\nexport const getRenderPosition = (\n  viewportElement: HTMLElement,\n  position: Position,\n  withCustomViewPort: Boolean,\n  width: number | undefined,\n  height: number | undefined,\n) => {\n  if (!width || !height) {\n    return undefined;\n  }\n\n  if (!withCustomViewPort) {\n    return getPosition(\n      (position?.x || 0) + window.scrollX,\n      (position?.y || 0) + window.scrollY,\n    );\n  }\n\n  const viewportRect = viewportElement.getBoundingClientRect();\n\n  if (\n    !position ||\n    position.x < 0 ||\n    position.y < 0 ||\n    position.x + width > viewportElement.clientWidth ||\n    position.y + height > viewportElement.clientHeight\n  ) {\n    return undefined;\n  }\n\n  return getPosition(\n    (position?.x || 0) + window.scrollX + viewportRect.left,\n    (position?.y || 0) + window.scrollY + viewportRect.top,\n  );\n};\n\nexport const getPositionsByDirection = ({\n  contentSize,\n  anchorSize,\n  position: { x, y },\n  arrowOffset = 0,\n  offset = 0,\n}: {\n  contentSize: Size;\n  anchorSize: Size;\n  position: NonNullable<Position>;\n  arrowOffset?: number;\n  offset?: number;\n}): PositionsByDirection => {\n  const { width: contentWidth, height: contentHeight } = contentSize;\n  const { width: anchorWidth, height: anchorHeight } = anchorSize;\n  const anchorCenter = {\n    x: x + anchorWidth / 2,\n    y: y + anchorHeight / 2,\n  };\n\n  const xForRightDirections = x + anchorWidth + offset;\n  const xForLeftDirections = x - contentWidth - offset;\n  const xForVerticalDirections = {\n    right: anchorCenter.x - arrowOffset,\n    center: anchorCenter.x - contentWidth / 2,\n    left: anchorCenter.x - contentWidth + arrowOffset,\n  };\n\n  const yForDownDirections = y + anchorHeight + offset;\n  const yForUpDirections = y - contentHeight - offset;\n  const yForHorizontalDirections = {\n    up: anchorCenter.y - contentHeight + arrowOffset,\n    center: anchorCenter.y - contentHeight / 2,\n    down: anchorCenter.y - arrowOffset,\n  };\n\n  const xForStartLeftDirections = x;\n  const xForStartRightDirections = x - contentWidth + anchorWidth;\n\n  const yForStartUpDirections = y;\n  const yForStartDownDirections = y - contentHeight + anchorHeight;\n\n  return {\n    upLeft: getPosition(xForVerticalDirections.left, yForUpDirections),\n    upCenter: getPosition(xForVerticalDirections.center, yForUpDirections),\n    upRight: getPosition(xForVerticalDirections.right, yForUpDirections),\n\n    downLeft: getPosition(xForVerticalDirections.left, yForDownDirections),\n    downCenter: getPosition(xForVerticalDirections.center, yForDownDirections),\n    downRight: getPosition(xForVerticalDirections.right, yForDownDirections),\n\n    rightUp: getPosition(xForRightDirections, yForHorizontalDirections.up),\n    rightCenter: getPosition(\n      xForRightDirections,\n      yForHorizontalDirections.center,\n    ),\n    rightDown: getPosition(xForRightDirections, yForHorizontalDirections.down),\n\n    leftUp: getPosition(xForLeftDirections, yForHorizontalDirections.up),\n    leftCenter: getPosition(\n      xForLeftDirections,\n      yForHorizontalDirections.center,\n    ),\n    leftDown: getPosition(xForLeftDirections, yForHorizontalDirections.down),\n\n    downStartLeft: getPosition(xForStartLeftDirections, yForDownDirections),\n    downStartRight: getPosition(xForStartRightDirections, yForDownDirections),\n\n    upStartLeft: getPosition(xForStartLeftDirections, yForUpDirections),\n    upStartRight: getPosition(xForStartRightDirections, yForUpDirections),\n\n    leftStartUp: getPosition(xForLeftDirections, yForStartUpDirections),\n    leftStartDown: getPosition(xForLeftDirections, yForStartDownDirections),\n\n    rightStartUp: getPosition(xForRightDirections, yForStartUpDirections),\n    rightStartDown: getPosition(xForRightDirections, yForStartDownDirections),\n  };\n};\n\ntype ComputedPositionAndDirectionParams = {\n  // Координата точки, к которой крепится поповер. Для якоря — координата левой верхней точки якоря\n  position: Position;\n  contentSize: Size;\n  viewportSize: Size;\n  anchorSize?: Size;\n  offset?: number;\n  arrowOffset?: number;\n  direction: Direction;\n  spareDirection: Direction;\n  possibleDirections: readonly Direction[];\n  bannedDirections: readonly Direction[];\n};\n\nexport const getComputedPositionAndDirection = ({\n  position: initialPosition,\n  contentSize,\n  viewportSize,\n  anchorSize = { width: 0, height: 0 },\n  arrowOffset,\n  direction: initialDirection,\n  possibleDirections,\n  bannedDirections,\n  spareDirection,\n  offset = 0,\n}: ComputedPositionAndDirectionParams): {\n  direction: Direction;\n  position: Position;\n} => {\n  if (!initialPosition) {\n    return { position: initialPosition, direction: initialDirection };\n  }\n\n  const positionsByDirection = getPositionsByDirection({\n    contentSize,\n    anchorSize,\n    position: initialPosition,\n    arrowOffset,\n    offset,\n  });\n\n  const direction =\n    [initialDirection, ...possibleDirections]\n      .filter((dir) => !bannedDirections.includes(dir))\n      .find((dir) => {\n        const pos = positionsByDirection[dir];\n        const { width, height } = contentSize;\n\n        const isFittingDown = pos.y + height <= viewportSize.height;\n        const isFittingUp = pos.y >= 0;\n\n        const isFittingLeft = pos.x >= 0;\n        const isFittingRight = pos.x + width <= viewportSize.width;\n\n        return isFittingUp && isFittingDown && isFittingLeft && isFittingRight;\n      }) || spareDirection;\n\n  return {\n    direction,\n    position: positionsByDirection[direction],\n  };\n};\n"],"mappings":"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"}