{"version":3,"file":"useAutoComplete.js","names":["useCallback","useEffect","useMemo","useRef","useState","scrollToIndex","useClickOutside","useFlag","useKeys","useRefs","getGroups","useAutoComplete","params","items","dropdownRef","disabled","getItemLabel","getItemKey","searchFunction","getItemGroupKey","groups","getGroupKey","onFocus","isLoading","dropdownOpen","onDropdownOpen","ignoreOutsideClicksRefs","searchValue","onChange","inputRef","isOpen","setIsOpen","highlightedIndex","setHighlightedIndex","handleChange","value","props","current","focus","searchFunctionDefault","item","toLocaleLowerCase","indexOf","filteredOptions","filter","visibleItems","resultGroups","length","hasItems","find","group","highlightIndex","indexForHighlight","Math","min","max","ArrowUp","_","e","preventDefault","on","old","ArrowDown","getKeyProps","PageUp","PageDown","Home","End","Enter","getItem","index","counter","Escape","off","Tab","optionsRefs","isActive","ignoreClicksInsideRefs","handler","blur","set","getOptionProps","key","onClick","onMouseEnter","active","hovered","handleInputFocus"],"sources":["../../../../../src/components/AutoCompleteCanary/useAutoComplete.ts"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\n\nimport { scrollToIndex } from '##/components/SelectComponents/useSelect/helpers';\nimport { useClickOutside } from '##/hooks/useClickOutside';\nimport { useFlag } from '##/hooks/useFlag';\nimport { KeyHandler, useKeys } from '##/hooks/useKeysDeprecated';\nimport { useRefs } from '##/hooks/useRefs';\nimport { getGroups } from '##/utils/getGroups';\n\nimport { AutoCompletePropOnChange } from './types';\n\ntype IndexForHighlight = number | ((oldIndex: number) => number);\n\ntype GetItemGroupKey<ITEM> = (item: ITEM) => string | number | undefined;\ntype GetGroupKey<GROUP> = (item: GROUP) => string | number | undefined;\n\ntype UseAutoCompleteProps<ITEM, GROUP> = {\n  getItemGroupKey?: GetItemGroupKey<ITEM> | undefined;\n  getGroupKey?: GetGroupKey<GROUP>;\n  groups?: GROUP[];\n  items: ITEM[];\n  dropdownRef: React.MutableRefObject<HTMLDivElement | null>;\n  disabled?: boolean;\n  getItemLabel: (item: ITEM) => string;\n  getItemKey: (item: ITEM) => string | number;\n  searchFunction?: (item: ITEM, searchValue: string) => boolean;\n  onFocus?: React.FocusEventHandler<HTMLInputElement>;\n  searchValue?: string;\n  onChange?: AutoCompletePropOnChange<'text'>;\n  isLoading?: boolean;\n  dropdownOpen?: boolean;\n  onDropdownOpen?: (isOpen: boolean) => void;\n  ignoreOutsideClicksRefs?: ReadonlyArray<React.RefObject<HTMLElement>>;\n};\n\ntype OptionProps<ITEM> = {\n  index: number;\n  item: ITEM;\n  keyPrefix: number;\n};\n\ntype GetOptionPropsResult = {\n  onClick: (e: React.MouseEvent) => void;\n  onMouseEnter: (e: React.MouseEvent) => void;\n  active: boolean;\n  hovered: boolean;\n  key: string | number;\n};\n\nexport function useAutoComplete<ITEM, GROUP>(\n  params: UseAutoCompleteProps<ITEM, GROUP>,\n) {\n  const {\n    items,\n    dropdownRef,\n    disabled = false,\n    getItemLabel,\n    getItemKey,\n    searchFunction,\n    getItemGroupKey,\n    groups,\n    getGroupKey,\n    onFocus,\n    isLoading,\n    dropdownOpen,\n    onDropdownOpen,\n    ignoreOutsideClicksRefs,\n    searchValue = '',\n    onChange,\n  } = params;\n\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const [isOpen, setIsOpen] = useFlag();\n  const [highlightedIndex, setHighlightedIndex] = useState<number>(-1);\n\n  const handleChange: AutoCompletePropOnChange<'text'> = (value, props) => {\n    if (!disabled && onChange) {\n      onChange(value, props);\n    }\n    inputRef.current?.focus();\n    setHighlightedIndex(-1);\n  };\n\n  const searchFunctionDefault = (item: ITEM, searchValue: string) => {\n    if (!searchValue) {\n      return false;\n    }\n    return (\n      getItemLabel(item)\n        .toLocaleLowerCase()\n        .indexOf(searchValue.toLocaleLowerCase()) !== -1\n    );\n  };\n\n  const filteredOptions = useMemo(\n    () =>\n      items.filter((item) =>\n        searchFunction\n          ? searchFunction(item, searchValue || '')\n          : searchFunctionDefault(item, searchValue || ''),\n      ),\n    [searchValue, items],\n  );\n\n  const visibleItems = useMemo(() => {\n    const resultGroups = getGroups(\n      filteredOptions,\n      groups?.length ? getItemGroupKey : undefined,\n      groups,\n      getGroupKey,\n      undefined,\n    );\n\n    return resultGroups;\n  }, [filteredOptions, groups, getItemGroupKey, getGroupKey]);\n\n  const hasItems = useMemo(() => {\n    return !!visibleItems.find((group) => group.items.length > 0);\n  }, [visibleItems]);\n\n  const highlightIndex = useCallback(\n    (indexForHighlight: IndexForHighlight) => {\n      setHighlightedIndex(\n        Math.min(\n          Math.max(\n            0,\n            typeof indexForHighlight === 'function'\n              ? indexForHighlight(highlightedIndex)\n              : indexForHighlight,\n          ),\n          filteredOptions.length - 1,\n        ),\n      );\n    },\n    [filteredOptions, highlightedIndex],\n  );\n\n  const ArrowUp: KeyHandler = (_, e): void => {\n    if (!disabled) {\n      e.preventDefault();\n      setIsOpen.on();\n      highlightIndex((old) => old - 1);\n    }\n  };\n\n  const ArrowDown: KeyHandler = (_, e): void => {\n    if (!disabled) {\n      e.preventDefault();\n      setIsOpen.on();\n      highlightIndex((old) => old + 1);\n    }\n  };\n\n  const Enter: KeyHandler = (_, e): void => {\n    if (isOpen) {\n      if (searchValue || filteredOptions[highlightedIndex]) {\n        e.preventDefault();\n      }\n\n      const getItem = (index: number) => {\n        let counter = 0;\n        for (const group of visibleItems) {\n          if (group.items.length + counter > index) {\n            return group.items[index - counter];\n          }\n          counter += group.items.length;\n        }\n        return undefined;\n      };\n\n      const item = getItem(highlightedIndex);\n\n      if (item) {\n        handleChange(getItemLabel(item), { e });\n      }\n    } else {\n      setIsOpen.on();\n    }\n  };\n\n  const Escape: KeyHandler = (): void => {\n    setIsOpen.off();\n  };\n\n  const Tab: KeyHandler = (_, e): void => {\n    setIsOpen.off();\n    if (isOpen && hasItems) {\n      e.preventDefault();\n    }\n  };\n\n  const getKeyProps = useKeys({\n    ArrowUp,\n    ArrowDown,\n    PageUp: ArrowUp,\n    PageDown: ArrowDown,\n    Home: ArrowUp,\n    End: ArrowDown,\n    Enter,\n    Escape,\n    Tab,\n  });\n\n  const getOptionProps = ({\n    index,\n    item,\n  }: OptionProps<ITEM>): GetOptionPropsResult => {\n    const key = getItemKey(item) || getItemLabel(item);\n\n    return {\n      onClick: (e: React.MouseEvent) => {\n        handleChange(getItemLabel(item), { e });\n      },\n      onMouseEnter: () => {\n        highlightIndex(index);\n      },\n      active: false,\n      hovered: index === highlightedIndex,\n      key,\n    };\n  };\n\n  const optionsRefs = useRefs<HTMLDivElement>(filteredOptions.length, [isOpen]);\n\n  const handleInputFocus = (e: React.FocusEvent<HTMLInputElement>): void => {\n    if (!disabled) {\n      setIsOpen.on();\n\n      if (typeof onFocus === 'function') {\n        onFocus(e);\n      }\n    }\n  };\n\n  useClickOutside({\n    isActive: isOpen,\n    ignoreClicksInsideRefs: [dropdownRef, ...(ignoreOutsideClicksRefs || [])],\n    handler: setIsOpen.off,\n  });\n\n  useEffect(() => {\n    if (disabled) {\n      setIsOpen.off();\n      inputRef.current?.blur();\n    }\n  }, [disabled]);\n\n  useEffect(() => {\n    if (filteredOptions.length > 0) {\n      scrollToIndex(highlightedIndex, dropdownRef, optionsRefs, () =>\n        highlightIndex(0),\n      );\n    }\n    setIsOpen.on();\n  }, [highlightedIndex]);\n\n  useEffect(() => {\n    onDropdownOpen?.(isOpen);\n    if (isOpen) {\n      setHighlightedIndex(0);\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    setIsOpen.set(dropdownOpen || false);\n  }, [dropdownOpen]);\n\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.value = searchValue;\n    }\n  }, [searchValue]);\n\n  return {\n    isOpen: Boolean(isOpen && (isLoading ? true : hasItems)),\n    visibleItems,\n    getOptionProps,\n    handleInputFocus,\n    inputRef,\n    getKeyProps,\n    hasItems,\n    optionsRefs,\n    handleChange,\n    highlightedIndex,\n  };\n}\n"],"mappings":"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"}